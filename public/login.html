<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login | CodeX Systems</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;0,700;1,700&display=swap');

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(rgba(0, 0, 15, 0.8), rgba(0, 0, 15, 0.8)), url('img/landing/web-banner.png');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.login-container {
  width: 100%;
  max-width: 420px;
  text-align: center;
  padding: 20px;
  animation: fadeIn 1s ease;
}

.logo {
  width: 250px;
  margin-bottom: 25px;
}

.login-box {
  background: #d1d1d1;
  padding: 40px 30px;
  border-radius: 30px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
  display: flex;
  flex-direction: column;
  align-items: center;
}

.login-box h2 {
  font-size: 32px;
  font-weight: 700;
  font-style: italic;
  margin: 0 0 30px 0;
  color: #000;
  letter-spacing: 2px;
}

.login-box input {
  width: 100%;
  padding: 15px;
  margin-bottom: 15px;
  border: 2px solid transparent;
  border-radius: 15px;
  background: #9e9e9e;
  color: #000;
  font-size: 16px;
  outline: none;
  box-sizing: border-box;
  transition: 0.3s;
}

/* Red border style */
.input-error {
  border: 2px solid #dc2626 !important;
}

#loginBtn {
  width: 50%;
  background: #00004d;
  color: white;
  border: none;
  border-radius: 50px;
  padding: 12px 0;
  font-size: 18px;
  font-weight: 700;
  font-style: italic;
  cursor: pointer;
  transition: 0.3s ease;
}

#loginBtn:disabled {
  background: #444;
  cursor: not-allowed;
}

.error-message {
  color: #dc2626;
  font-size: 13px;
  font-weight: 600;
  margin-top: 15px;
  text-align: center;
  display: none;
  line-height: 1.4;
}

.links {
  margin-top: 20px;
  font-size: 12px;
}

.links a {
  color: #0000ff;
  text-decoration: none;
  font-weight: 700;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<div class="login-container">
  <img src="img/logo.png" alt="CodeX Logo" class="logo">
  <div class="login-box">
    <h2>LOG-IN</h2>
    <input type="email" id="loginEmail" placeholder="USERNAME" required>
    <input type="password" id="loginPassword" placeholder="PASSWORD" required>
    
    <button type="button" id="loginBtn">login</button>

    <div id="errorBox" class="error-message"></div>
    
    <div class="links">
      <p>forgot password? <a href="#">Forgot Password</a></p>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCrZdFPMkDikE5M8Q2V5-Moixvt2jPZGPM",
    authDomain: "camar-hr.firebaseapp.com",
    databaseURL: "https://camar-hr-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "camar-hr",
    storageBucket: "camar-hr.firebasestorage.app",
    messagingSenderId: "760270102206",
    appId: "1:760270102206:web:c3acfe8d8615f5647788ef"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const errorBox = document.getElementById('errorBox');
  const emailInput = document.getElementById('loginEmail');
  const passInput = document.getElementById('loginPassword');
  const loginBtn = document.getElementById('loginBtn');

  // Helper to clear errors
  function clearError() {
    errorBox.style.display = "none";
    emailInput.classList.remove("input-error");
    passInput.classList.remove("input-error");
  }

  // Helper to show errors
  function showInputError(message) {
    errorBox.textContent = message;
    errorBox.style.display = "block";
    emailInput.classList.add("input-error");
    passInput.classList.add("input-error");
  }

  emailInput.addEventListener('input', clearError);
  passInput.addEventListener('input', clearError);

  loginBtn.addEventListener("click", async () => {
    const email = emailInput.value.trim();
    const password = passInput.value.trim();

    clearError();

    // 1. Validation Logic
    if (!email || !password) {
      showInputError("Please fill all fields.");
      return;
    } 
    
    if (!email.includes("@")) {
      showInputError("Please enter a valid email address (must include @).");
      return;
    }

    if (password.length < 6) {
      showInputError("Password is too short (minimum 6 characters).");
      return;
    }

    // 2. Firebase Login
    loginBtn.disabled = true;
    loginBtn.textContent = "...";

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      const adminEmails = ["arnoldcamar.admin@gmail.com"];
      const hrEmails = ["maprincess.hr@gmail.com"]; 
    
      sessionStorage.setItem("userSession", "active");
      sessionStorage.setItem("userEmail", user.email);

      if (adminEmails.includes(user.email)) {
        window.location.href = "admin.html";
      } else if (hrEmails.includes(user.email)) {
        window.location.href = "hr-dashb.html";
      } else {
        window.location.href = "emp-dashb.html";
      }

    } catch (error) {
      showInputError("Invalid email and password combination.");
      loginBtn.disabled = false;
      loginBtn.textContent = "login";
    }
  });
</script>
</body>
</html>